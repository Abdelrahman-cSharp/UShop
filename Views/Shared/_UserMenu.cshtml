@using Microsoft.AspNetCore.Identity
@using UShop.Models
@inject UserManager<User> UserManager

@{
	var user = await UserManager.GetUserAsync(User);
	var currentUser = await UserManager.GetUserAsync(User);

	var userName = currentUser?.UserType switch
	{
		UserType.Seller => currentUser.Seller?.FullName ?? currentUser.UserName,
		UserType.Admin => currentUser.Admin?.FullName ?? currentUser.UserName,
		UserType.Customer => currentUser.Customer?.FullName ?? currentUser.UserName,
		_ => currentUser?.UserName
	};

}

<ul class="navbar-nav">
	<li class="nav-item dropdown user-menu-dropdown">
		<a class="nav-link d-flex align-items-center" href="#" id="userDropdown" role="button">
			<i class="fas fa-user-circle fa-2x me-1"></i>
		</a>

		<ul class="dropdown-menu shadow-lg border-0 rounded-3" aria-labelledby="userDropdown">
			@if (User.Identity?.IsAuthenticated ?? false)
			{
				<!-- Logged in -->
				<li class="px-3 py-3 bg-light border-bottom">
					<div class="d-flex align-items-center">
						<i class="fas fa-user-circle fa-3x text-primary me-3"></i>
						<div>
							<div class="fw-bold">@userName</div>
							<small class="text-muted">@User.Identity.Name</small>
						</div>
					</div>
				</li>
				<li>
					<a class="dropdown-item py-2" asp-controller="Account" asp-action="Profile">
						<i class="fas fa-id-card me-2"></i> Profile
					</a>
				</li>
				@if (User.IsInRole("Seller"))
				{
					<li>
						<a class="dropdown-item py-2" asp-controller="Products" asp-action="Index">
							<i class="fas fa-id-card me-2"></i> My Products
						</a>
					</li>
				}
				<li>
					<a class="dropdown-item py-2" asp-controller="Orders" asp-action="Index">
						<i class="fas fa-id-card me-2"></i> My Orders
					</a>
				</li>
				<li>
					<form asp-controller="Account" asp-action="Logout" method="post" class="d-inline">
						<button type="submit" class="dropdown-item text-danger fw-semibold">
							<i class="fas fa-sign-out-alt me-2"></i> Logout
						</button>
					</form>
				</li>
			}
			else
			{
				<!-- Guest -->
				<li class="px-3 py-3 bg-light text-center">
					<i class="fas fa-user-circle fa-3x text-secondary"></i>
					<div class="mt-2 fw-semibold">Welcome Guest</div>
				</li>
				<li><hr class="dropdown-divider" /></li>
				<li>
					<a class="dropdown-item py-2" asp-controller="Account" asp-action="Login">
						<i class="fas fa-sign-in-alt me-2"></i> Login
					</a>
				</li>
				<li>
					<a class="dropdown-item py-2" asp-controller="Account" asp-action="Register">
						<i class="fas fa-user-plus me-2"></i> Sign Up
					</a>
				</li>
			}
		</ul>
	</li>
</ul>

<style>
	/* Show dropdown on hover (desktop) */

	@@media (min-width: 992px) {
		.user-menu-dropdown:hover .dropdown-menu {
			display: block;
			opacity: 1;
			margin-top: 0;
		}
	}

	/* Center dropdown under the icon */
	.user-menu-dropdown {
		position: relative;
	}

		.user-menu-dropdown .dropdown-menu {
			/* Uncomment & tweak if you want to center */
			left: 50% !important;
			transform: translateX(-90%);
			right: auto !important;
			display: none;
			opacity: 0;
			transition: opacity 0.2s ease-in-out;
		}

	.navbar .nav-link:hover, .navbar .nav-link:focus {
		text-decoration: none !important;
	}
</style>
