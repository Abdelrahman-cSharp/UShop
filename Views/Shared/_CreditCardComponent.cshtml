@model UShop.Models.Customer
@using UShop.Models

<div class="card shadow-sm p-3">
    @if (Model?.CreditCard == null)
    {
        <div class="alert alert-warning mb-2">
            No credit card on file.
        </div>
        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#createCardModal">
            Add Credit Card
        </button>
    }
    else
    {
        var cc = Model.CreditCard;
        <h5 class="card-title">Saved Credit Card</h5>
        <p><strong>Cardholder:</strong> @cc.CardholderName</p>
        <p><strong>Card Number:</strong> **** **** **** @cc.CardNumber[^4..]</p>
        <p><strong>Expiry:</strong> @cc.ExpiryMonth/@cc.ExpiryYear</p>

        <button class="btn btn-warning me-2"
                data-bs-toggle="modal"
                data-bs-target="#editCardModal">
            Edit
        </button>
        <button class="btn btn-danger"
                data-bs-toggle="modal"
                data-bs-target="#deleteCardModal">
            Delete
        </button>
    }
</div>

<!-- ---------- Create Modal ---------- -->
<div class="modal fade" id="createCardModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header"><h5 class="modal-title">Add Credit Card</h5></div>
            <div class="modal-body">
                <form asp-controller="CreditCard" asp-action="Create" method="post">
                    @Html.AntiForgeryToken()
                    <div class="mb-2">
                        <label>Card Number</label>
                        <input name="CardNumber" class="form-control" required />
                    </div>
                    <div class="mb-2">
                        <label>Cardholder Name</label>
                        <input name="CardholderName" class="form-control" required />
                    </div>
                    <div class="row">
                        <div class="col">
                            <label>Expiry Month</label>
                            <input name="ExpiryMonth" type="number" min="1" max="12" class="form-control" required />
                        </div>
                        <div class="col">
                            <label>Expiry Year</label>
                            <input name="ExpiryYear" type="number" min="2025" max="2050" class="form-control" required />
                        </div>
                    </div>
                    <div class="mb-2">
                        <label>CVV</label>
                        <input name="CVV" type="password" class="form-control" required />
                    </div>
                    <button type="submit" class="btn btn-primary">Save</button>
                </form>
            </div>
        </div>
    </div>
</div>

@if (Model?.CreditCard != null)
{
    <!-- ---------- Edit Modal ---------- -->
    <div class="modal fade" id="editCardModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header"><h5 class="modal-title">Edit Credit Card</h5></div>
                <div class="modal-body">
                    <form asp-controller="CreditCard" asp-action="Edit" method="post">
                        @Html.AntiForgeryToken()
                        <input type="hidden" name="Id" value="@Model.CreditCard.Id" />
                        <div class="mb-2">
                            <label>Card Number</label>
                            <input name="CardNumber" value="@Model.CreditCard.CardNumber" class="form-control" required />
                        </div>
                        <div class="mb-2">
                            <label>Cardholder Name</label>
                            <input name="CardholderName" value="@Model.CreditCard.CardholderName" class="form-control" required />
                        </div>
                        <div class="row">
                            <div class="col">
                                <label>Expiry Month</label>
                                <input name="ExpiryMonth" type="number" value="@Model.CreditCard.ExpiryMonth" min="1" max="12" class="form-control" required />
                            </div>
                            <div class="col">
                                <label>Expiry Year</label>
                                <input name="ExpiryYear" type="number" value="@Model.CreditCard.ExpiryYear" min="2025" max="2050" class="form-control" required />
                            </div>
                        </div>
                        <div class="mb-2">
                            <label>CVV</label>
                            <input name="CVV" type="password" value="@Model.CreditCard.CVV" class="form-control" required />
                        </div>
                        <button type="submit" class="btn btn-primary">Update</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- ---------- Delete Modal ---------- -->
    <div class="modal fade" id="deleteCardModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header"><h5 class="modal-title">Delete Credit Card</h5></div>
                <div class="modal-body">
                    <p>Are you sure you want to delete this card ending in @Model.CreditCard.CardNumber[^4..] ?</p>
                    <form asp-controller="CreditCard" asp-action="Delete" asp-route-id="@Model.CreditCard.Id" method="post">
                        @Html.AntiForgeryToken()
                        <button type="submit" class="btn btn-danger">Delete</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
}
