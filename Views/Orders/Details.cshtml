@model UShop.Models.Order
@{
	ViewData["Title"] = "Order Details";
}

<div class="card shadow-sm border-0 rounded-4 mb-4" style="background: #ffecec;">
	<div class="card-body">
		<h4 class="card-title text-dark">Order #@Model.Id</h4>
		<p><strong>Customer:</strong> @Model.Customer?.FullName</p>
		<p><strong>Date:</strong> @Model.OrderDate.ToString("dd/MM/yyyy")</p>
		<p><strong>Status:</strong> <span class="badge bg-info text-dark">@Model.Status</span></p>
		<p class="fw-bold"><strong>Total:</strong> @Model.TotalAmount.ToString("C")</p>
	</div>
</div>

<h4 class="mb-3 text-dark">Items</h4>

<div class="p-3 mb-4 rounded-4" style="background: linear-gradient(135deg, #fff4e6, #ffe7cc);">
	<div class="row justify-content-center">
		@foreach (var item in Model.Items)
		{
			<div class="col-sm-10 col-md-6 col-lg-4 mb-4">
				<div class="card shadow-sm border-0 rounded-4 text-center h-100"
						 style="background:#fff9f0; max-width:320px; margin:auto;">

					<!-- Image section with rounded top corners -->
					<div class="d-flex justify-content-center align-items-center bg-white rounded-top-4"
							 style="height:260px;">
						<img src="@item.Product?.ImageUrl"
								 alt="@item.Product?.Name"
								 style="max-height:100%; max-width:100%; object-fit:contain; padding:8px;" />
					</div>

					<div class="card-body">
						<h5 class="fw-semibold text-dark">@item.Product?.Name</h5>
						<p class="text-muted mb-1">Qty: @item.Quantity</p>
						<p class="text-muted mb-1">Unit Price: @item.UnitPrice.ToString("C")</p>
						<p class="fw-bold text-dark">Total: @item.TotalPrice.ToString("C")</p>
					</div>
				</div>
			</div>
		}
	</div>
</div>

@* Cancel Order Section - Only show for orders that can be cancelled *@
@if (Model.Status == UShop.Models.OrderStatus.Pending || Model.Status == UShop.Models.OrderStatus.Processing)
{
	<div class="mt-4 text-center">
		<div class="alert alert-warning d-inline-block">
			<strong>📋 Note:</strong> You can cancel this order while it's still being processed.
		</div>
		<div class="mt-3">
			<a asp-action="CancelConfirmation" asp-route-id="@Model.Id"
				 class="btn btn-danger btn-lg me-2">
				🚫 Cancel Order
			</a>
		</div>
	</div>
}
else if (Model.Status == UShop.Models.OrderStatus.Cancelled)
{
	<div class="mt-4 text-center">
		<div class="alert alert-secondary">
			<strong>❌ This order has been cancelled.</strong>
		</div>
	</div>
}
else if (Model.Status == UShop.Models.OrderStatus.Delivered)
{
	<div class="mt-4 text-center">
		<div class="alert alert-success">
			<strong>✅ This order has been delivered successfully!</strong>
		</div>
	</div>
}
else if (Model.Status == UShop.Models.OrderStatus.Shipped)
{
	<div class="mt-4 text-center">
		<div class="alert alert-info">
			<strong>🚚 This order has been shipped and cannot be cancelled.</strong>
		</div>
	</div>
}

@* Display Success/Error Messages *@
@if (TempData["Success"] != null)
{
	<div class="alert alert-success alert-dismissible fade show mt-3" role="alert">
		<strong>✅ Success!</strong> @TempData["Success"]
		<button type="button" class="btn-close" data-bs-dismiss="alert"></button>
	</div>
}

@if (TempData["Error"] != null)
{
	<div class="alert alert-danger alert-dismissible fade show mt-3" role="alert">
		<strong>❌ Error!</strong> @TempData["Error"]
		<button type="button" class="btn-close" data-bs-dismiss="alert"></button>
	</div>
}

@* Navigation *@
<div class="mt-4 text-center">
	<a asp-action="Index" class="btn btn-secondary btn-lg">← Back to Orders</a>
</div>
